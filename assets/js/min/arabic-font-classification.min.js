window.onload = (() => { var t = new FontFaceObserver("ArefRuqaa"), e = new FontFaceObserver("WebNastaliq"), a = null, n = null, d = (n = document.getElementById("prediction-container"), document.getElementById("canvas")), i = d.getContext("2d"); i.font = "40px ArefRuqaa"; var o = ["أ", "ب", "ت", "ث", "ج", "ح", "خ", "د", "ذ", "ر", "ز", "س", "ش", "ص", "ض", "ط", "ظ", "ع", "غ", "ف", "ق", "ك", "ل", "م", "ن", "ه", "و", "ي"], r = ["30px", "40px", "50px", "60px", "70px"], g = ["ArefRuqaa", "WebNastaliq"]; function l(t) { i.fillStyle = "white", i.fillRect(0, 0, 100, 100), i.fillStyle = "rgba(0, 0, 0, 1)"; let e = "ArefRuqaa"; switch (document.getElementById("font-select").value) { case "ruqaa": e = "ArefRuqaa"; break; case "farsi": e = "WebNastaliq"; break; default: e = "ArefRuqaa" }i.font = "40px " + e, i.textAlign = "center", i.fillText(t, 50, 60) } function u(t) { return Math.floor(Math.random() * Math.floor(t)) } function s(t) { function e() { i.drawImage(t, 0, 0, 100, 100); let e = d.toDataURL("image/jpeg").replace("image/jpeg", "image/octet-stream"), o = document.createElement("img"); o.width = 100, o.height = 100, o.src = e, o.onload = (() => { imgtensor = tf.browser.fromPixels(o).mean(2).toFloat().expandDims(-1), imgtensor = tf.image.resizeNearestNeighbor(imgtensor, [100, 100]), imgtensor = imgtensor.reshape([1, 100, 100, 1]), imgds = tf.data.array([imgtensor]), imgds = imgds.batch(1), a.predict(imgtensor).data().then(t => { n.innerHTML = parseFloat(t.toString()) > .5 ? "Ruqaa" : "Nastaliq (Farsi)" }) }) } null == a ? (document.getElementById("loading-model-text").innerText = "Loading model...", tf.loadLayersModel("../../assets/jsmodels/fontmodel/model.json").then(t => { a = t, document.getElementById("loading-model-text").classList.add("success"), document.getElementById("loading-model-text").innerText = "Model loaded", setTimeout(() => document.getElementById("loading-model-text").classList.add("hidden"), 1500), console.log("model loaded") })).then(() => { e() }) : e() } Promise.all([t.load(), e.load()]).then(function () { l(document.getElementById("input-text").value), document.querySelectorAll("#sample-images-container img").forEach(function (t) { t.addEventListener("click", function () { s(t) }) }), document.getElementById("upload-image").addEventListener("input", function () { if (this.files && this.files[0]) { let t = document.createElement("img"); t.width = 100, t.height = 100, t.src = URL.createObjectURL(this.files[0]), t.onload = (() => s(t)) } }), document.getElementById("synthesize-btn").addEventListener("click", function () { i.fillStyle = "white", i.fillRect(0, 0, 100, 100); let t = document.getElementById("input-text").value, e = document.getElementById("font-select").value, a = "ArefRuqaa"; switch (e) { case "ruqaa": a = "ArefRuqaa"; break; case "farsi": a = "WebNastaliq"; break; default: a = "ArefRuqaa" }let n = u(48) + 1, d = () => (u(26) + 75) / 100, l = u(5) + 3, s = (u(2) + 3) / 100, c = () => u(5), y = (u(26), () => u(51) + 25); randomBgImg = document.createElement("img"), randomBgImg.src = "../assets/imgs/arabic-font-classification/bgs/bg" + n + ".jpg", randomBgImg.width = 100, randomBgImg.height = 100, randomBgImg.onload = (() => { if (i.globalAlpha = d(), i.drawImage(randomBgImg, 0, 0, 100, 100), n <= 15) { let t = ""; for (let e = 0; e <= l; e++)t += o[u(28)]; i.fillStyle = "black", i.globalAlpha = s, i.font = r[c()] + " " + g[(() => u(2))()], i.fillText(t, y(), y()) } i.globalAlpha = 1, i.font = r[c()] + " " + a, i.fillStyle = "rgba(0, 0, 0, " + d() + ")", i.fillText(t, y(), y()) }) }), document.getElementById("font-select").addEventListener("input", function () { l(document.getElementById("input-text").value) }), document.getElementById("predict-btn").addEventListener("click", function () { let t = d.toDataURL("image/jpeg").replace("image/jpeg", "image/octet-stream"), e = document.createElement("img"); e.src = t, e.width = 100, e.height = 100, e.onload = (() => s(e)) }), document.getElementById("input-text").oninput = function (t) { l(t.target.value) } }, function () { console.log("Error loading fonts") }); var c = { value: "51%" }, y = { value: 105702 }, f = { value: 20 }, m = { x: 100, y: 50 }, p = { value: 100 }, x = { value: 2 }, v = { value: 30 }, b = { value: 100 }, I = { x: 50, y: 60 }, B = { value: 50 }, h = anime.timeline({ autoplay: !1, loop: !1, easing: "linear", update: function (t) { E.value = h.progress } }), E = document.querySelector("#fig3 .animejs-controls .progress"); document.querySelector("#fig3 .animejs-controls .play").onclick = h.play, document.querySelector("#fig3 .animejs-controls .pause").onclick = h.pause, document.querySelector("#fig3 .animejs-controls .restart").onclick = h.restart, E.addEventListener("input", function () { h.seek(h.duration * (E.value / 100)) }), E.addEventListener("mousedown", function () { h.pause() }), E.addEventListener("mouseup", function () { h.play() }), h.add({ targets: ["#fig3-annot1", "#fig3-bgs-container"], duration: 300, opacity: 1, delay: anime.stagger(500) }).add({ targets: "#fig3-bgs", duration: 2500, translateX: "-288px", easing: "easeInOutBack", delay: 2e3 }).add({ targets: "#fig3-gen-bg", duration: 200, opacity: 1, delay: 200 }).add({ targets: ["#fig3-annot2", "#fig3-bg-opacity-container"], duration: 300, opacity: 1, delay: 1e3 }).add({ targets: c, duration: 5e3, value: "79%", delay: 1e3, round: 1, easing: "spring(1.5, 20, 6, 0)", update: function () { document.querySelector("#fig3-bg-opacity-container tspan").textContent = c.value, document.getElementById("fig3-gen-bg").style.opacity = Number(c.value.substring(0, 2)) / 100 } }).add({ targets: ["#fig3-annot1", "#fig3-bgs-container", "#fig3-annot2", "#fig3-bg-opacity-container"], opacity: 0, delay: 700, duration: 300 }).add({ targets: ["#fig3-annot3", "#fig3-wordlist-container", "#fig3-annot4"], duration: 300, opacity: 1, delay: anime.stagger(700) }).add({ targets: "#fig3-wordlist", duration: 3500, translateX: "-220px", easing: "easeInOutBack", delay: 4e3 }).add({ targets: "#fig3-gen-bg-text", duration: 200, opacity: 1, delay: 200 }).add({ targets: "#fig3-wordlist-word1", duration: 200, opacity: .7, fill: "#f00", delay: 500 }).add({ targets: y, duration: 500, value: 105701, round: 1, delay: 500, update: () => { document.getElementById("fig3-wordlist-count").textContent = y.value } }).add({ targets: "#fig3-bg-text-font-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: "#fig3-gen-bg-text", duration: 10, opacity: 0, delay: 10 }).add({ targets: "#fig3-gen-bg-text2", duration: 10, opacity: 1, delay: 10 }).add({ targets: "#fig3-bg-text-size-container", duration: 300, opacity: 1, delay: 1e3 }).add({ targets: f, duration: 2e3, value: 50, round: 1, delay: 700, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-bg-text-size tspan").textContent = f.value } }).add({ targets: "#fig3-gen-bg-text2", duration: 10, opacity: 0, delay: 10 }).add({ targets: "#fig3-gen-bg-text3", duration: 10, opacity: 1, delay: 10 }).add({ targets: "#fig3-bg-text-pos-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: m, duration: 2e3, x: 80, y: 150, round: 1, delay: 700, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-bg-text-pos tspan").textContent = "x: " + m.x + "px, y: " + m.y + "px", anime({ targets: "#fig3-gen-bg-text3", duration: 1e3, translateX: -(m.x - 75), translateY: m.y / 2 - 45 }) } }).add({ targets: "#fig3-bg-text-opacity-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: p, duration: 2e3, value: 10, round: 1, delay: 700, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-bg-text-opacity tspan").textContent = (p.value > 100 ? 100 : p.value) + "%", anime({ targets: "#fig3-gen-bg-text3", duration: 1e3, opacity: p.value / 100 }) } }).add({ targets: "#fig3-annot3", opacity: 1, duration: 2500, delay: 100 }).add({ targets: ["#fig3-bg-text-opacity-container", "#fig3-bg-text-pos-container", "#fig3-bg-text-size-container", "#fig3-bg-text-font-container", "#fig3-annot3"], duration: 300, delay: anime.stagger(300), opacity: 0 }).add({ targets: "#fig3-annot3", opacity: 0, duration: 500, delay: 100 }).add({ targets: ["#fig3-annot5-1", "#fig3-num-words-container"], opacity: 1, duration: 300, delay: anime.stagger(2e3) }).add({ targets: x, duration: 200, delay: 1800, round: 1, value: 3, update: () => { document.querySelector("#fig3-num-words tspan").textContent = x.value } }).add({ targets: x, duration: 200, delay: 200, round: 1, value: 1, update: () => { document.querySelector("#fig3-num-words tspan").textContent = x.value } }).add({ targets: x, duration: 200, delay: 200, round: 1, value: 3, update: () => { document.querySelector("#fig3-num-words tspan").textContent = x.value } }).add({ targets: x, duration: 200, delay: 200, round: 1, value: 1, update: () => { document.querySelector("#fig3-num-words tspan").textContent = x.value } }).add({ targets: "#fig3-annot5-2", duration: 300, opacity: 1, delay: 1500 }).add({ targets: "#fig3-wordlist", duration: 3500, translateX: "-54px", easing: "easeInOutBack", delay: 2500 }).add({ targets: "#fig3-gen-text", opacity: 1, duration: 300, delay: 500 }).add({ targets: "#fig3-wordlist-word2", duration: 200, opacity: .7, fill: "#f00", delay: 500 }).add({ targets: y, duration: 500, value: 105700, round: 1, delay: 500, update: () => { document.getElementById("fig3-wordlist-count").textContent = y.value } }).add({ targets: "#fig3-annot5-3", duration: 300, opacity: 1, delay: 1500 }).add({ targets: "#fig3-text-size-container", opacity: 1, duration: 300, delay: 2e3 }).add({ targets: v, duration: 2e3, value: 75, round: 1, delay: 700, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-text-size tspan").textContent = v.value } }).add({ targets: "#fig3-gen-text", duration: 10, opacity: 0, delay: 10 }).add({ targets: "#fig3-gen-text2", duration: 10, opacity: 1, delay: 10 }).add({ targets: "#fig3-text-opacity-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: b, duration: 2e3, value: 70, round: 1, delay: 700, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-text-opacity tspan").textContent = (b.value > 100 ? 100 : b.value) + "%", anime({ targets: "#fig3-gen-text2", duration: 300, opacity: b.value / 100 }) } }).add({ targets: "#fig3-text-pos-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: "#fig3-text-pos-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: I, duration: 2e3, x: 10, y: 75, round: 1, delay: 100, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-text-pos tspan").textContent = "x: " + I.x + "px, y: " + I.y + "px", anime({ targets: "#fig3-gen-text2", duration: 1e3, translateX: -(I.x - 27), translateY: I.y / 2 - 45 }) } }).add({ targets: "#fig3-annot5-1", opacity: 1, duration: 2500, delay: 100 }).add({ targets: ["#fig3-text-pos-container", "#fig3-text-opacity-container", "#fig3-text-size-container", "#fig3-num-words-container", "#fig3-annot4", "#fig3-wordlist-container"], duration: 300, delay: anime.stagger(300), opacity: 0 }).add({ targets: ["#fig3-annot5-3", "#fig3-annot5-2", "#fig3-annot5-1"], duration: 300, opacity: 0, delay: 300 }).add({ targets: ["#fig3-annot6"], duration: 300, delay: 1e3, opacity: 1 }).add({ targets: B, duration: 1e3, delay: 1e3, value: 100, round: 1, easing: "easeInOutBack", update: () => { document.getElementById("fig3-gen-noise").style.opacity = Number(B.value) } }).add({ targets: ["#fig3-annot6"], duration: 300, delay: 300, opacity: 1 }).add({ targets: ["#fig3-annot7", "#fig3-real-gs", "#fig3-gen-gs"], opacity: 1, delay: anime.stagger(500), duration: 300 }) });