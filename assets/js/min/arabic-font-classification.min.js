window.onload = (() => { var t = new FontFaceObserver("ArefRuqaa"), e = new FontFaceObserver("WebNastaliq"), a = null, n = null, o = (n = document.getElementById("prediction-container"), document.getElementById("canvas")), i = o.getContext("2d"); i.font = "40px ArefRuqaa"; var d = ["أ", "ب", "ت", "ث", "ج", "ح", "خ", "د", "ذ", "ر", "ز", "س", "ش", "ص", "ض", "ط", "ظ", "ع", "غ", "ف", "ق", "ك", "ل", "م", "ن", "ه", "و", "ي"], r = ["30px", "40px", "50px", "60px", "70px"], g = ["ArefRuqaa", "WebNastaliq"]; function l() { Promise.all([t.load(), e.load()]).then(u, function (a) { console.log(a, "Error loading fonts, trying again..."), Promise.all([t.load(), e.load()]).then(u, function (t) { document.getElementById("loading-fonts-text").classList.add("error"), console.log(t) }) }) } function u() { document.getElementById("loading-fonts-text").classList.remove("error"), s(document.getElementById("input-text").value), document.querySelectorAll("#sample-images-container img").forEach(function (t) { t.addEventListener("click", function () { y(t) }) }), document.getElementById("upload-image").addEventListener("input", function () { if (this.files && this.files[0]) { let t = document.createElement("img"); t.width = 100, t.height = 100, t.src = URL.createObjectURL(this.files[0]), t.onload = (() => y(t)) } }), document.getElementById("synthesize-btn").addEventListener("click", function () { i.fillStyle = "white", i.fillRect(0, 0, 100, 100); let t = document.getElementById("input-text").value, e = document.getElementById("font-select").value, a = "ArefRuqaa"; switch (e) { case "ruqaa": a = "ArefRuqaa"; break; case "farsi": a = "WebNastaliq"; break; default: a = "ArefRuqaa" }let n = c(48) + 1, o = () => (c(26) + 75) / 100, l = c(5) + 3, u = (c(2) + 3) / 100, s = () => c(5), y = (c(26), () => c(51) + 25); randomBgImg = document.createElement("img"), randomBgImg.src = "../assets/imgs/arabic-font-classification/bgs/bg" + n + ".jpg", randomBgImg.width = 100, randomBgImg.height = 100, randomBgImg.onload = (() => { if (i.globalAlpha = o(), i.drawImage(randomBgImg, 0, 0, 100, 100), n <= 15) { let t = ""; for (let e = 0; e <= l; e++)t += d[c(28)]; i.fillStyle = "black", i.globalAlpha = u, i.font = r[s()] + " " + g[(() => c(2))()], i.fillText(t, y(), y()) } i.globalAlpha = 1, i.font = r[s()] + " " + a, i.fillStyle = "rgba(0, 0, 0, " + o() + ")", i.fillText(t, y(), y()) }) }), document.getElementById("font-select").addEventListener("input", function () { s(document.getElementById("input-text").value) }), document.getElementById("predict-btn").addEventListener("click", function () { let t = o.toDataURL("image/jpeg").replace("image/jpeg", "image/octet-stream"), e = document.createElement("img"); e.src = t, e.width = 100, e.height = 100, e.onload = (() => y(e)) }), document.getElementById("input-text").oninput = function (t) { s(t.target.value) } } function s(t) { i.fillStyle = "white", i.fillRect(0, 0, 100, 100), i.fillStyle = "rgba(0, 0, 0, 1)"; let e = "ArefRuqaa"; switch (document.getElementById("font-select").value) { case "ruqaa": e = "ArefRuqaa"; break; case "farsi": e = "WebNastaliq"; break; default: e = "ArefRuqaa" }i.font = "40px " + e, i.textAlign = "center", i.fillText(t, 50, 60) } function c(t) { return Math.floor(Math.random() * Math.floor(t)) } function y(t) { function e() { i.drawImage(t, 0, 0, 100, 100); let e = o.toDataURL("image/jpeg").replace("image/jpeg", "image/octet-stream"), d = document.createElement("img"); d.width = 100, d.height = 100, d.src = e, d.onload = (() => { imgtensor = tf.browser.fromPixels(d).mean(2).toFloat().expandDims(-1), imgtensor = tf.image.resizeNearestNeighbor(imgtensor, [100, 100]), imgtensor = imgtensor.reshape([1, 100, 100, 1]), imgds = tf.data.array([imgtensor]), imgds = imgds.batch(1), a.predict(imgtensor).data().then(t => { document.querySelector(".prediction-container-wrapper .prediction-icon svg").classList.remove("predict"), n.innerHTML = parseFloat(t.toString()) > .5 ? "Ruqaa" : "Nastaliq (Farsi)" }) }) } n.innerHTML = " ", document.querySelector(".prediction-container-wrapper .prediction-icon svg").classList.add("predict"), null == a ? (document.getElementById("loading-model-text").innerText = "Loading model...", tf.loadLayersModel("../../assets/jsmodels/fontmodel/model.json").then(t => { a = t, document.getElementById("loading-model-text").classList.add("success"), document.getElementById("loading-model-text").innerText = "Model loaded", setTimeout(() => document.getElementById("loading-model-text").classList.add("hidden"), 1500), console.log("model loaded") })).then(() => { e() }) : e() } document.getElementById("retry-loading-fonts").addEventListener("click", l), l(); var f = { value: "51%" }, m = { value: 105702 }, p = { value: 20 }, x = { x: 100, y: 50 }, v = { value: 100 }, b = { value: 2 }, I = { value: 30 }, B = { value: 100 }, E = { x: 50, y: 60 }, h = { value: 50 }, q = anime.timeline({ autoplay: !1, loop: !1, easing: "linear", update: function (t) { w.value = q.progress } }), w = document.querySelector("#fig3 .animejs-controls .progress"); document.querySelector("#fig3 .animejs-controls .play").onclick = q.play, document.querySelector("#fig3 .animejs-controls .pause").onclick = q.pause, document.querySelector("#fig3 .animejs-controls .restart").onclick = q.restart, w.addEventListener("input", function () { q.seek(q.duration * (w.value / 100)) }), w.addEventListener("mousedown", function () { q.pause() }), w.addEventListener("mouseup", function () { q.play() }), q.add({ targets: ["#fig3-annot1", "#fig3-bgs-container"], duration: 300, opacity: 1, delay: anime.stagger(500) }).add({ targets: "#fig3-bgs", duration: 2500, translateX: "-288px", easing: "easeInOutBack", delay: 2e3 }).add({ targets: "#fig3-gen-bg", duration: 200, opacity: 1, delay: 200 }).add({ targets: ["#fig3-annot2", "#fig3-bg-opacity-container"], duration: 300, opacity: 1, delay: 1e3 }).add({ targets: f, duration: 5e3, value: "79%", delay: 1e3, round: 1, easing: "spring(1.5, 20, 6, 0)", update: function () { document.querySelector("#fig3-bg-opacity-container tspan").textContent = f.value, document.getElementById("fig3-gen-bg").style.opacity = Number(f.value.substring(0, 2)) / 100 } }).add({ targets: ["#fig3-annot1", "#fig3-bgs-container", "#fig3-annot2", "#fig3-bg-opacity-container"], opacity: 0, delay: 700, duration: 300 }).add({ targets: ["#fig3-annot3", "#fig3-wordlist-container", "#fig3-annot4"], duration: 300, opacity: 1, delay: anime.stagger(700) }).add({ targets: "#fig3-wordlist", duration: 3500, translateX: "-220px", easing: "easeInOutBack", delay: 4e3 }).add({ targets: "#fig3-gen-bg-text", duration: 200, opacity: 1, delay: 200 }).add({ targets: "#fig3-wordlist-word1", duration: 200, opacity: .7, fill: "#f00", delay: 500 }).add({ targets: m, duration: 500, value: 105701, round: 1, delay: 500, update: () => { document.getElementById("fig3-wordlist-count").textContent = m.value } }).add({ targets: "#fig3-bg-text-font-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: "#fig3-gen-bg-text", duration: 10, opacity: 0, delay: 10 }).add({ targets: "#fig3-gen-bg-text2", duration: 10, opacity: 1, delay: 10 }).add({ targets: "#fig3-bg-text-size-container", duration: 300, opacity: 1, delay: 1e3 }).add({ targets: p, duration: 2e3, value: 50, round: 1, delay: 700, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-bg-text-size tspan").textContent = p.value } }).add({ targets: "#fig3-gen-bg-text2", duration: 10, opacity: 0, delay: 10 }).add({ targets: "#fig3-gen-bg-text3", duration: 10, opacity: 1, delay: 10 }).add({ targets: "#fig3-bg-text-pos-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: x, duration: 2e3, x: 80, y: 150, round: 1, delay: 700, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-bg-text-pos tspan").textContent = "x: " + x.x + "px, y: " + x.y + "px", anime({ targets: "#fig3-gen-bg-text3", duration: 1e3, translateX: -(x.x - 75), translateY: x.y / 2 - 45 }) } }).add({ targets: "#fig3-bg-text-opacity-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: v, duration: 2e3, value: 10, round: 1, delay: 700, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-bg-text-opacity tspan").textContent = (v.value > 100 ? 100 : v.value) + "%", anime({ targets: "#fig3-gen-bg-text3", duration: 1e3, opacity: v.value / 100 }) } }).add({ targets: "#fig3-annot3", opacity: 1, duration: 2500, delay: 100 }).add({ targets: ["#fig3-bg-text-opacity-container", "#fig3-bg-text-pos-container", "#fig3-bg-text-size-container", "#fig3-bg-text-font-container", "#fig3-annot3"], duration: 300, delay: anime.stagger(300), opacity: 0 }).add({ targets: "#fig3-annot3", opacity: 0, duration: 500, delay: 100 }).add({ targets: ["#fig3-annot5-1", "#fig3-num-words-container"], opacity: 1, duration: 300, delay: anime.stagger(2e3) }).add({ targets: b, duration: 200, delay: 1800, round: 1, value: 3, update: () => { document.querySelector("#fig3-num-words tspan").textContent = b.value } }).add({ targets: b, duration: 200, delay: 200, round: 1, value: 1, update: () => { document.querySelector("#fig3-num-words tspan").textContent = b.value } }).add({ targets: b, duration: 200, delay: 200, round: 1, value: 3, update: () => { document.querySelector("#fig3-num-words tspan").textContent = b.value } }).add({ targets: b, duration: 200, delay: 200, round: 1, value: 1, update: () => { document.querySelector("#fig3-num-words tspan").textContent = b.value } }).add({ targets: "#fig3-annot5-2", duration: 300, opacity: 1, delay: 1500 }).add({ targets: "#fig3-wordlist", duration: 3500, translateX: "-54px", easing: "easeInOutBack", delay: 2500 }).add({ targets: "#fig3-gen-text", opacity: 1, duration: 300, delay: 500 }).add({ targets: "#fig3-wordlist-word2", duration: 200, opacity: .7, fill: "#f00", delay: 500 }).add({ targets: m, duration: 500, value: 105700, round: 1, delay: 500, update: () => { document.getElementById("fig3-wordlist-count").textContent = m.value } }).add({ targets: "#fig3-annot5-3", duration: 300, opacity: 1, delay: 1500 }).add({ targets: "#fig3-text-size-container", opacity: 1, duration: 300, delay: 2e3 }).add({ targets: I, duration: 2e3, value: 75, round: 1, delay: 700, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-text-size tspan").textContent = I.value } }).add({ targets: "#fig3-gen-text", duration: 10, opacity: 0, delay: 10 }).add({ targets: "#fig3-gen-text2", duration: 10, opacity: 1, delay: 10 }).add({ targets: "#fig3-text-opacity-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: B, duration: 2e3, value: 70, round: 1, delay: 700, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-text-opacity tspan").textContent = (B.value > 100 ? 100 : B.value) + "%", anime({ targets: "#fig3-gen-text2", duration: 300, opacity: B.value / 100 }) } }).add({ targets: "#fig3-text-pos-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: "#fig3-text-pos-container", duration: 300, opacity: 1, delay: 500 }).add({ targets: E, duration: 2e3, x: 10, y: 75, round: 1, delay: 100, easing: "easeInOutBack", update: () => { document.querySelector("#fig3-text-pos tspan").textContent = "x: " + E.x + "px, y: " + E.y + "px", anime({ targets: "#fig3-gen-text2", duration: 1e3, translateX: -(E.x - 27), translateY: E.y / 2 - 45 }) } }).add({ targets: "#fig3-annot5-1", opacity: 1, duration: 2500, delay: 100 }).add({ targets: ["#fig3-text-pos-container", "#fig3-text-opacity-container", "#fig3-text-size-container", "#fig3-num-words-container", "#fig3-annot4", "#fig3-wordlist-container"], duration: 300, delay: anime.stagger(300), opacity: 0 }).add({ targets: ["#fig3-annot5-3", "#fig3-annot5-2", "#fig3-annot5-1"], duration: 300, opacity: 0, delay: 300 }).add({ targets: ["#fig3-annot6"], duration: 300, delay: 1e3, opacity: 1 }).add({ targets: h, duration: 1e3, delay: 1e3, value: 100, round: 1, easing: "easeInOutBack", update: () => { document.getElementById("fig3-gen-noise").style.opacity = Number(h.value) } }).add({ targets: ["#fig3-annot6"], duration: 300, delay: 300, opacity: 1 }).add({ targets: ["#fig3-annot7", "#fig3-real-gs", "#fig3-gen-gs"], opacity: 1, delay: anime.stagger(500), duration: 300 }) });